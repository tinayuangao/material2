<div [attr.role]="'combobox'"
     (click)="toggle()"
     [id]="id"
     [attr.tabindex]="tabIndex"
     [attr.aria-label]="_ariaLabel"
     [attr.aria-labelledby]="ariaLabelledby"
     [attr.aria-required]="required.toString()"
     [attr.aria-disabled]="disabled.toString()"
     [attr.aria-invalid]="errorState"
     [attr.aria-owns]="_getAriaOwns()"
     [attr.aria-describedby]="_ariaDescribedby || null"
     [attr.aria-activedescendant]="_getAriaActiveDescendant()"
     [attr.aria-expanded]="panelOpen"
     aria-required="false"
     aria-autocomplete="none"
     cdk-overlay-origin
     class="mat-select-trigger"
     #origin="cdkOverlayOrigin"
     #trigger>
  <div class="mat-select-value" [ngSwitch]="empty" role="textbox" [id]="_labelId">
    <span class="mat-select-placeholder" *ngSwitchCase="true">{{placeholder || '\u00A0'}}</span>
    <span class="mat-select-value-text" *ngSwitchCase="false" [ngSwitch]="!!customTrigger">
      <span *ngSwitchDefault>{{triggerValue}}</span>
      <ng-content select="mat-select-trigger" *ngSwitchCase="true"></ng-content>
    </span>
  </div>

  <div class="mat-select-arrow-wrapper"><div class="mat-select-arrow"></div></div>
</div>

<ng-template
  cdk-connected-overlay
  cdkConnectedOverlayLockPosition
  cdkConnectedOverlayHasBackdrop
  cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
  [cdkConnectedOverlayScrollStrategy]="_scrollStrategy"
  [cdkConnectedOverlayOrigin]="origin"
  [cdkConnectedOverlayOpen]="panelOpen"
  [cdkConnectedOverlayPositions]="_positions"
  [cdkConnectedOverlayMinWidth]="_triggerRect?.width"
  [cdkConnectedOverlayOffsetY]="_offsetY"
  (backdropClick)="close()"
  (attach)="_onAttached()"
  (detach)="close()">

  <div
    #panel
    class="mat-select-panel {{ _getPanelTheme() }}"
    [ngClass]="panelClass"
    [@transformPanel]="multiple ? 'showing-multiple' : 'showing'"
    (@transformPanel.done)="_onPanelDone()"
    [style.transformOrigin]="_transformOrigin"
    [class.mat-select-panel-done-animating]="_panelDoneAnimating"
    [style.font-size.px]="_triggerFontSize"
    (keydown)="_handleKeydown($event)">
    <div
      class="mat-select-content"
      [@fadeInContent]="'showing'"
      (@fadeInContent.done)="_onFadeInDone()">
      <ng-content></ng-content>

      <div aria-hidden="true" role="presentation">
        <ng-container matOptionOutlet></ng-container>
      </div>
    </div>
  </div>
</ng-template>


<!-- Listbox and options are always in the DOM and do not use the user's template.
     The listbox must be `display: none` while the combobox is not expanded so that
     its activedescendant doesn't take effect. -->
<div role="listbox"
     [id]="_listboxId"
     [attr.aria-multiselectable]="multiple"
     [style.display]="panelOpen ? 'block' : 'none'"
     class="cdk-visually-hidden"
     *ngIf="optionTemplate">
  <div role="option" *ngFor="let opt of optionData; let index = index"
       id="{{_listboxId}}-opt-{{index}}"
       aria-disabled="false"
       [attr.aria-selected]="_selectionModel.isSelected(opt)">
    {{optionTextTransform(opt)}}
  </div>
  <div role="group" *ngFor="let group of optionDataGroups; let index = index"
       id="{{_listboxId}}-group-{{index}}"
       aria-disabled="false">
    <div role="option" *ngFor="let opt of groupOptionsAccessor(group); let optindex = index"
         id="{{_listboxId}}-group-{{index}}-opt-{{optindex}}"
         aria-disabled="false"
         [attr.aria-selected]="_selectionModel.isSelected(opt)">
      {{optionTextTransform(opt)}}
    </div>
  </div>
</div>


<!-- Workaround for VoiceOver + Safari not correctly supporting activedescendant https://bugs.webkit.org/show_bug.cgi?id=167671 -->
<!-- Real implementation will use cdk LiveAnnouncer -->
<!--<div class="cdk-visually-hidden" aria-live="polite" aria-atomic="false">-->
  <!--{{announceText}}-->
<!--</div>-->
<!--
  Notes:
  * VoiceOver + Safari doesn't say anything after you select an option.
-->
